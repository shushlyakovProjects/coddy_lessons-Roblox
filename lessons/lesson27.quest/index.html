<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROBLOX - Lesson 27</title>
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../css/section.css">
    <link rel="stylesheet" href="../../css/media.css">
    <link rel="icon" href="../../img/base/favicon.png">
</head>

<body>

    <!-- 
    ИНСТРУКЦИЯ
    <h1></h1>
    <h2></h2>
    <h3></h3>
    <p></p>
    <p class="story"></p>
    <p class="code"></p>
    <p class="important"></p>
    <img src="" alt="">
    <div class="box__images2"> 
    -->

    <main>
        <header>
            <img src="../../img/base/logo.svg" alt="" class="logo">
            <h1>Создание игр в Roblox Studio</h1>
        </header>

        <section>
            <h1>Создание квеста. Часть 1</h1>

            <h2>Диалоговая система</h2>
            <p>В этом занятии мы приступим к созданию квеста, основываясь на диалоговой системе, созданной ранее. Метод создания квестов, используемый в этом и следующем занятиях, является облегчённой и упрощенной версией классического способа создания квестов в Roblox Studio.</p>
            <p>Процесс будет разделён на два занятия. В первом мы создадим базовую часть: подготовим скрипты, создадим связанные с ними переменные, добавим квестовые предметы и разберёмся, как редактировать уже существующий диалог.</p>

            <h3>Подготовка диалога</h3>
            <p class="important">Квест, который будет создан в этом занятии, будет достаточно простым: необходимо найти 5 квестовых объектов (в качестве примера будет использован алмаз) и принести их NPC.</p>
            <p>Обычно Dialog добавляется в качестве дочернего объекта к голове NPC. Выберите вашего NPC, раскройте его группу в Explorer и найдите в частях тела голову.</p>
            <p class="story">Прежде чем приступать к написанию квеста, необходимо подготовить ранее созданный диалог, чтобы он подходил по смыслу. В деталях вашего NPC найдите компонент Head и отредактируйте ветку взятия квеста так, чтобы NPC говорил, что ему нужно собрать 5 квестовых предметов. После сообщения сути квеста, перед игроком должен встать выбор: взять квест или отказаться.</p>
            <img src="img/Screenshot_1.png" alt="">
            <p class="story">Добавьте два дополнительных варианта ответа: TakeQuest И RejectQuest. Измените их параметры UserDialog И ResponseDialog на соответствующие фразы игрока и NPC:</p>
            <img src="img/Screenshot_2.png" alt="">

            <h3>Создание квестовых переменных</h3>
            <p>Несмотря на то, что квесты в играх - достаточно увлекательная и интересная часть геймплея, на самом деле с точки зрения программирования, это просто набор переменных и связанных с ними функций, запускающихся после активации квеста.</p>
            <p class="important">Любой квест состоит из трёх фаз: принятие квеста, его выполнение и получение награды. Эти фазы должны каким-то образом отслеживаться игрой - для этого создаются специальные переменные, которые хранят в себе информацию, связанную с квестом.</p>
            <p>Для хранения этих переменных мы будем использовать рюкзак игрока - специальное место в структуре игры, в котором хранятся все объекты, принадлежащие отдельному игроку. Обычно рюкзак используется для хранения предметов, которые может использовать персонаж (оружие, надеваемая одежда, различные инструменты и т.д.). Однако, мы можем создать в нём скрытую папку, в которой будут храниться квестовые переменные.</p>
            <p class="important">В окне Explorer найдите сервис <b>StarterPack</b> - это хранилище вещей игрока. Все объекты, находящиеся в StarterPack, автоматически добавятся каждому игроку, вошедшему в игру.</p>
            <p class="story">Создайте подпапку Quest1 и добавьте в неё внешнюю переменную типа boolValue. Назовите её <b>QuestTaken</b>.</p>
            <img src="img/Screenshot_3.png" alt="">
            <p>Эта переменная будет отслеживать, согласился ли игрок на выполнение квеста или нет. Она должна изменить свое значение на true в тот момент, когда игрок выберет соответствующую опцию в диалоге (TakeQuest).</p>

            <h3>Изменение внешней переменной через скрипт</h3>
            <p>Чтобы включить переменную QuestTaken через диалог, необходимо отредактировать диалоговый скрипт.</p>
            <p class="story">В окне ToolBox необходимо найти диалоговый скрипт с названием <b>Coddy_26_DialogScript</b> и добавить его в папку <b>StarterPlayerScripts</b>, находящуюся в папке <b>StarterPlayer</b>.</p>
            <img src="img/Screenshot_4.png" alt="">
            <p class="story">Далее в сервис ReplicatedStorage добавьте удалённое событие RemoteEvent, переименуйте его на DialogueChosen:</p>
            <img src="img/Screenshot_5.png" alt="">
            <p class="story">В исходном диалоговом скрипте, который вы добавили из ToolBox, вместо Dummy нужно написать название вашего NPC, как оно записано в Explorer. Вместо Choice1, Choice2, Choice3 и Choice4 нужно вставить название вариантов ответа (DialogChoice), которые вы добавляли к диалогу.</p>
            <img src="img/Screenshot_6.png" alt="">

            <p class="story">Добавим ещё одну локальную переменную player, в которой хранится ссылка на локального игрока, чтобы исключить любые ситуации неопределенной работы кода. Локальный игрок - это игрок, на компьютере которого запущена игра. Также в первой строке добавим паузу при помощи функции wait(2), чтобы игрок успел прогрузиться. </p>
            <img src="img/Screenshot_7.png" alt="">
            <p class="story">Далее добавим команду для изменения значения переменной. Оно должно изменяться в том случае, если игрок выбрал вариант диалога TakeQuest. Добавьте отслеживание этой ветки диалога:</p>
            <img src="img/Screenshot_8.png" alt="">
            <p class="story">Через ссылку на игрока получим доступ к его рюкзаку, а после найдём и изменим значение переменной:</p>
            <img src="img/Screenshot_9.png" alt="">
            <p class="story">Запустите игру, найдите переменную в рюкзаке игрока через сервис Players и через окно Properties проверьте её изменение при взятии квеста:</p>
            <img src="img/Screenshot_10.png" alt="">

            <h3>Добавление квестового объекта</h3>
            <p>Следующий этап работы - добавление предмета, который нужно будет подобрать для выполнения квеста. Вы можете выбрать любой предмет, который нужно будет найти и подобрать, в качестве примера будет использоваться алмаз. Желательно найти в тулбоксе подходящую 3D-модель, не содержащую каких-либо скриптов и дополнительных компонентов. Если вы будете добавлять объект из раздела Models, очистите его от всего, кроме непосредственно самой 3D-модели.</p>
            <img src="img/Screenshot_11.png" alt="">
            <p>Найдите в тулбоксе скрипт вращения из первого модуля Coddy_RotatePart и добавьте его к квестовому предмету.</p>
            <p class="story">Прежде чем переходить к написанию скрипта, добавьте дополнительную переменную типа intValue в рюкзак игрока и назовите её ItemsCollected. Она будет считать, сколько квестовых предметов вы собрали.</p>
            <img src="img/Screenshot_12.png" alt="">
            <p class="story">Создайте дополнительный скрипт и назовите его PickUpScript.</p>
            <img src="img/Screenshot_13.png" alt="">
            <p class="story">Цель этого скрипта - отслеживать касания персонажей и увеличивать переменную ItemsCollected на единицу после подбора игроком. Напишите следующий код внутри созданного скрипта:</p>
            <img src="img/Screenshot_14.png" alt="">
            <p class="story">В переменной object хранится обращение к родительскому элементу скрипта - то есть к квестовому предмету.</p>
            <img src="img/Screenshot_15.png" alt="">
            <p>После соприкосновении с игроком, скрипт обнаруживает часть, коснувшуюся квестового предмета, после чего находит его родительскую группу (персонажа) и записывает ее в переменную character.</p>
            <p class="story">Персонаж - это сущность, принадлежащая сервису Workspace, в то время как игрок и его переменная находятся в сервисе Players. Чтобы получить доступ к игроку, управляющему персонажем, используется специальный метод GetPlayerFromCharacter.</p>
            <img src="img/Screenshot_16.png" alt="">
            <p class="story">После получения доступа к игроку, можно найти переменную-счётчик и увеличить её на единицу. После этого объект должен уничтожиться, чтобы избежать ложных срабатываний.</p>
            <img src="img/Screenshot_17.png" alt="">
            <p class="story">Запустите игру, найдите переменную в рюкзаке игрока, подберите квестовый предмет и проверьте в окне Properties, увеличилось ли значение переменной ItemsCollected.</p>
            <img src="img/Screenshot_18.png" alt="">

            <h2>Редактирование диалога через скрипт</h2>
            <p>После того, как игрок получил квест, NPC должен поменять свои реплики, так как игровая ситуация изменилась. Чтобы сделать это автоматически после того, как игрок согласится на выполнение квеста, нужно дописать соответствующие команды в диалоговый скрипт.</p>
            <p class="story">Создадим новую функцию ChangeDialog. Эта функция должна запуститься после выбора варианта ответа с согласием на квест и заменить нужные реплики.</p>
            <div class="box__images2">
                <img src="img/Screenshot_19.png" alt="">
                <img src="img/Screenshot_20.png" alt="">
            </div>
            <p class="story">Изменим открывающую реплику NPC. Вместо фразы о том, что у персонажа есть дело к игроку, NPC спросит, как продвигается квест. Для этого необходимо поменять параметр InitialPrompt y главного объекта Dialog.</p>
            <img src="img/Screenshot_21.png" alt="">
            <p class="story">Далее измените реплики игрока и ответы на них через параметры UserDialog и ResponseDialog соответствующих веток диалога.</p>
            <img src="img/Screenshot_22.png" alt="">
            <p class="story">Запустите игру, возьмите квест, после чего снова обратитесь к NPC. Если всё сделано правильно, вы увидите новые реплики.</p>
            <img src="img/Screenshot_23.png" alt="">
            <p class="story">После того, как игрок взял квест, в диалоге остаются ненужные ветки TakeQuest и RejectQuest. Добавьте команды для их удаления:</p>
            <img src="img/Screenshot_24.png" alt="">
            <p class="story">Также добавим функцию AddBranch, автоматически добавляющую дополнительные варианты ответа в диалоговую систему:</p>
            <img src="img/Screenshot_25.png" alt="">
            <p class="story">В параметры этой функции передаются родительский объект (ветка, после выбора которой будет появляться этот вариант), реплика игрока и ответ NPC.</p>
            <img src="img/Screenshot_26.png" alt="">
            <p>Скрипт создает новый объект типа DialogueChoice, делает его дочерним к объекту, указанному в первом параметре, и изменяет параметры UserDialog И ResponseDialog.</p>
            <p class="story">Добавьте новую ветку диалога с поомщью созданной функции:</p>
            <img src="img/Screenshot_27.png" alt="">
            <p class="story">Запустите игру и проверьте новую ветку диалога в работе:</p>
            <img src="img/Screenshot_28.png" alt="">
            <p>Всё готово! Дополнительно можно доработать диалоговую систему и добавить дополнительные ветки, появляющиеся после взятия квеста.</p>




            <hr>
            <h1>Домашкаа 😁</h1>
            <p>На следующем занятии мы создадим награду, которую получит игрок за выполнение квеста.</p>
            <ol>
                <li>Вам необходимо на сайте Roblox во вкладке Marketplace выбрать предмет, который NPC выдаст игроку в качестве награды.</li>
                <li>Выберите, что этот предмет будет давать персонажу как магический артефакт: увеличение скорости, усиление прыжка, увеличение здоровья, ускорение регенерации или невидимость.</li>
                <li>Сохраните ID этого объекта или сфотографируйте название, чтобы можно было использовать его на следующем занятии.</li>
            </ol>

        </section>
    </main>
</body>

</html>
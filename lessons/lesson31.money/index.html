<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROBLOX - Lesson 31</title>
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../css/section.css">
    <link rel="stylesheet" href="../../css/media.css">
    <link rel="icon" href="../../img/base/favicon.png">
</head>

<body>

    <!-- 
    ИНСТРУКЦИЯ
    <h1></h1>
    <h2></h2>
    <h3></h3>
    <p></p>
    <p class="story"></p>
    <p class="code"></p>
    <p class="important"></p>
    <img src="" alt="">
    <div class="box__images2"> 
    -->

    <main>
        <header>
            <img src="../../img/base/logo.svg" alt="" class="logo">
            <h1>Создание игр в Roblox Studio</h1>
        </header>

        <section>
            <h1>Денежная система Roblox. Часть 1</h1>

            <h2>Внутриигровая денежная система</h2>
            <h3>Создание денежной системы</h3>
            <p class="important">Внутриигровая валюта устроена достаточно просто - это просто переменная, привязанная к
                конкретному игроку. Обычно количество денег отображается в интерфейсе, в котором просто выводится
                значение этой переменной.</p>
            <p>Так как к значению должны будут получать доступ различные объекты (враги, интерфейс, магазин), оно должно
                быть вынесено во внешнюю переменную и храниться в месте, привязанном к конкретному игроку. Как и в 7
                модуле при работе с квестовыми переменными, создадим внешние значения в рюкзаке игрока.</p>
            <p class="story">Найдите папку StarterPack в окне Explorer и добавьте дочернюю папку Variables. Внутри нее
                добавьте объект intValue, переименуйте его в Cash:</p>
            <img src="img/Screenshot_1.png" alt="">
            <p>В этой внешней переменной будет храниться количество денег игрока. Даже если персонаж игрока умрет,
                значение сохранится и не изменится при респауне.</p>

            <h3>Создание интерфейса для отображения количества валюты</h3>
            <p class="story">Теперь добавим интерфейс для отображения текущего количества валюты. В сервис StarterGui
                добавьте специальный объект ScreenGui, после чего добавьте дочерний объект Frame:</p>
            <img src="img/Screenshot_2.png" alt="">
            <p class="story">Растяните фрейм на верхнюю часть экрана тонкой полоской - это подложка под элементы
                интерфейса. Измените его цвет на темный и прозрачность на 0.5-0.65.</p>
            <img src="img/Screenshot_3.png" alt="">
            <p class="story">Далее добавьте дочерний объект TextLabel. Настройте текст так, чтобы он подходил по
                стилистике и замените надпись (параметр Text) на количество денег:</p>
            <img src="img/Screenshot_4.png" alt="">
            <p>Теперь необходимо сделать так, чтобы текст этой надписи менялся в зависимости от значения переменной
                Cash, созданной ранее. Добавьте объекту TextLabel дочерний локальный скрипт (LocalScript). Скрипт должен
                постоянно отслеживать количество денег локального игрока и изменять параметр Text родительской надписи в
                соответствии с ним.</p>
            <p class="story">Добавим ссылки на игрока и родительскую надпись:</p>
            <img src="img/Screenshot_5.png" alt="">
            <p class="story">Создадим бесконечный цикл, который будет проверять интересующее нас значение и записывать
                его в переменную:</p>
            <img src="img/Screenshot_6.png" alt="">
            <p>Далее необходимо сделать так, чтобы в тексте надписи отображалось не только значение, но и поясняющий
                префикс, в данном случае знак доллара. То есть отображаться должно не, например, 400, а $ 400. Чтобы это
                сделать, необходимо «сшить» текстовое и числовое значения.</p>
            <p class="important">Это делается при помощи конкатенации строк - объединения нескольких значений в одну
                текстовую строку. Чтобы объединить два текстовых значения, в LUA используется специальный оператор «..».
            </p>
            <p class="story">При помощи конкатенации соединим префикс и количество денег игрока. После этого также
                добавим небольшую задержку перед следующим повтором цикла:</p>
            <img src="img/Screenshot_7.png" alt="">

            <h2>Изменение количества валюты</h2>
            <h3>Добавление противника</h3>
            <p class="story">Теперь добавим бандита, за убийство которого игрок получит деньги. Для этого занятия
                подготовлен специальный бандит, найдите его в тулбоксе по названию Coddy_Thug и добавьте на карту.</p>
            <img src="img/Screenshot_8.png" alt="">
            <p class="story">Это - спаунер бандита. Как только бандит умрет, спаунер создаст нового в изначальной точке
                размещения. Раскройте иерархию объекта в Explorer и найдите скрипт Respawn.</p>
            <img src="img/Screenshot_9.png" alt="">
            <p>Этот скрипт отслеживает здоровье бандита и в случае, если его здоровье падает ниже 1, создает клона
                изначального бандита, размещает его в стартовой точке и уничтожает побежденный экземпляр.</p>
            <img src="img/Screenshot_10.png" alt="">
            <p>Именно в этой части кода мы сможем добавить действия, которые найдут игрока, нанесшего последний урон и
                увеличить количество его денег.</p>

            <h3>Система тегов и отслеживания выстрелов игроков</h3>
            <p class="important">Для отслеживания нанесения урона игроками, оружие в Roblox использует систему тегов.
                Каждый успешный выстрел по гуманоидной цели создает специальный объект ObjectValue, в который
                записывается ссылка на игрока, нанесшего урон.</p>
            <p>Этот объект создается автоматически и добавляется в дочерние объекты компонента Humanoid противника.
                После добавления этот объект переименовывается в creator - это универсальное имя для тэгов урона от
                оружия. Именно благодаря тому, что это имя всегда одинаково, большинство скриптов и оружия в Roblox
                могут работать бесшовно, несмотря на то что были созданы разными людьми.</p>
            <p>Вернемся к скрипту Respawn. Когда здоровье противника упадет ниже 1, скрипт должен найти игрока,
                нанесшего последний урон и начислить ему награду за победу.</p>
            <p class="story">Чтобы найти игрока, нужно найти тэг внутри компонента Humanoid и прочесть его значение -
                это прямая ссылка на игрока. Введем переменную и запишем в нее результат поиска дочернего тега по имени
                "creator":</p>
            <img src="img/Screenshot_11.png" alt="">
            <p>Скорее всего, противник умрет от действий игрока, однако он также может погибнуть и от падения за пределы
                карты, ловушек, урона от другого противника и других действий, не связанных с игроком. В таком случае
                тэга внутри Humanoid может не оказаться и, если мы попытаемся обратиться к нулевому значению, скрипт
                сломается и перестанет работать.</p>
            <p class="story">Поэтому обязательно добавим проверку на валидность значения:</p>
            <img src="img/Screenshot_12.png" alt="">
            <p class="story">После этого обратимся к переменной Cash и увеличим ее значение на 200:</p>
            <img src="img/Screenshot_13.png" alt="">
            <p>Чтобы проверить работу скрипта, добавьте стартовое оружие из тулбокса. Большинство оружия работает
                правильно, однако зачастую можно случайно добавить сломанное или неправильно запрограммированное
                вооружение, ломающее игру.</p>
            <p class="important">В случае, если после запуска игры вы не сможете ее закрыть (пропал курсор),
                воспользуйтесь горячей клавишей Shift-F5, чтобы принудительно завершить игру. После этого удалите
                сломанное оружие из папки StarterPack.</p>
            <p>Запустите игру, убейте бандита и проверьте, изменилось ли значение в интерфейсе.</p>



            <hr>
            <h1>Домашкаа 😁</h1>
            <p>Необходимо доделать то, что не вы не успели сделать на предыдущем и текущем занятиях.</p>
            <p>Также нужно подумать над тем, какие объекты вы бы хотели продавать в своём магазине и по какой цене.</p>

        </section>
    </main>
</body>

</html>